{{ define "main" }}
<header class="hero-card">
  <div class="hero-inner">
    <h1>ğŸŒ¸ HITSZ æ—¥è¯­ç¤¾</h1>
    <p>ã“ã“ã¯æ—¥æœ¬èªã‚µãƒ¼ã‚¯ãƒ«ã®å…¬å¼ã‚µã‚¤ãƒˆã§ã™ â€” æ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„æ–‡åŒ–æ—…ç¨‹ï¼</p>
  </div>
  <!-- èŠ±ç“£å®¹å™¨ -->
  <div class="petals"></div>
</header>

<main class="card-row">

<!-- å…³äºæˆ‘ä»¬ -->
{{ $about := where .Site.RegularPages "Section" "about" | first 1 }}
{{ range $about }}
<section class="card large" data-animate>
  <h2>å…³äºæˆ‘ä»¬</h2>
  <div class="card-content">
    {{ .Summary | safeHTML }} <!-- Hugo ä¼šè‡ªåŠ¨ç”Ÿæˆæ‘˜è¦ -->
  </div>
  <a href="{{ .RelPermalink }}" class="more">æŸ¥çœ‹æ›´å¤š â†’</a>
</section>
{{ end }}

<!-- å…¬å‘Š -->
{{ $news := where .Site.RegularPages "Section" "news" | first 1 }}
{{ range $news }}
<section class="card large" data-animate>
  <h2>å…¬å‘Š</h2>
  <div class="card-content">
    <strong>{{ .Title }}</strong>
    {{ .Summary | truncate 200 | safeHTML }}
  </div>
  <a href="{{ .RelPermalink }}" class="more">é˜…è¯»æ›´å¤š â†’</a>
</section>
{{ else }}
<section class="card large" data-animate>
  <h2>å…¬å‘Š</h2>
  <p class="card-content">æš‚æ— å…¬å‘Šã€‚</p>
</section>
{{ end }}

<!-- æ´»åŠ¨ -->
{{ $allEvents := where .Site.RegularPages "Section" "events" }}
{{ $publishedEvents := where $allEvents "Draft" "!=" true }}
{{ $sortedEvents := sort $publishedEvents ".Lastmod" "desc" }}
{{ $latestEvent := first 1 $sortedEvents }}

{{ range $latestEvent }}
<section class="card medium" data-animate>
  <h2>æ´»åŠ¨</h2>
  <div class="card-content">
    <strong>{{ .Title }}</strong>
    {{ if .Summary }}
      {{ .Summary | truncate 150 | safeHTML }}
    {{ else }}
      <p>æš‚æ— ç®€ä»‹ã€‚</p>
    {{ end }}
  </div>
  <a href="{{ .RelPermalink }}" class="more">æŸ¥çœ‹è¯¦æƒ… â†’</a>
</section>
{{ else }}
<section class="card medium" data-animate>
  <h2>æ´»åŠ¨</h2>
  <p class="card-content">æš‚æ— æ´»åŠ¨ã€‚</p>
</section>
{{ end }}

<!-- æ¯å‘¨ä¸€æ›² -->
{{ $allLyrics := where .Site.RegularPages "Section" "lyrics" }}
{{ $publishedLyrics := where $allLyrics "Draft" "!=" true }}
{{ $sortedLyrics := sort $publishedLyrics ".Lastmod" "desc" }}
{{ $latestLyrics := first 1 $sortedLyrics }}

{{ range $latestLyrics }}
<section class="card medium" data-animate>
  <h2>æ¯å‘¨ä¸€æ›²</h2>
  <div class="card-content">
    <strong>{{ .Title }}</strong>
    {{ if .Summary }}
      {{ .Summary | truncate 150 | safeHTML }}
    {{ else }}
      <p>æš‚æ— ç®€ä»‹ã€‚</p>
    {{ end }}
  </div>
  <a href="{{ .RelPermalink }}" class="more">æŸ¥çœ‹è¯¦æƒ… â†’</a>
</section>
{{ else }}
<section class="card medium" data-animate>
  <h2>æ¯å‘¨ä¸€æ›²</h2>
  <p class="card-content">æš‚æ— æ›²ç›®ã€‚</p>
</section>
{{ end }}

<!-- è”ç³»æ–¹å¼ -->
{{ $join := where .Site.RegularPages "Section" "join" | first 1 }}
{{ range $join }}
<section class="card small" data-animate>
  <h2>åŠ å…¥æˆ‘ä»¬</h2>
  <div class="card-content">
    {{ .Summary | truncate 100 | safeHTML }}
  </div>
  <a href="{{ .RelPermalink }}" class="more">æŸ¥çœ‹æŠ¥åæ–¹å¼ â†’</a>
</section>
{{ end }}

</main>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const cards = document.querySelectorAll("[data-animate]");

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        entry.target.classList.add("in-view");
        observer.unobserve(entry.target); // åªè§¦å‘ä¸€æ¬¡
      }
    });
  }, { threshold: 0.1 });

  cards.forEach(card => observer.observe(card));
});
</script>
<script>
const petalsContainer = document.querySelector('.petals');
const petalsCount = 30; // èŠ±ç“£æ•°é‡

for (let i = 0; i < petalsCount; i++) {
  const petal = document.createElement('div');
  petal.classList.add('petal');
  
  // éšæœºæ°´å¹³ä½ç½®
  petal.style.left = Math.random() * 100 + '%';
  // éšæœºå¤§å°
  const size = Math.random() * 10 + 10; // 10px ~ 20px
  petal.style.width = size + 'px';
  petal.style.height = size + 'px';
  // éšæœºåŠ¨ç”»æ—¶é•¿
  petal.style.animationDuration = (5 + Math.random() * 5) + 's';
  // éšæœºå»¶è¿Ÿ
  petal.style.animationDelay = Math.random() * 5 + 's';
  
  petalsContainer.appendChild(petal);
}
</script>

{{ end }}