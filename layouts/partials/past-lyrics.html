{{/* 
  partial: past-lyrics.html
  功能: 查询当前文章所在 Section 的历史文章，按 Date/Lastmod 排序
*/}}

{{ $allLyrics := where .Site.RegularPages "Section" "lyrics" }}
{{ $publishedLyrics := where $allLyrics "Draft" "!=" true }}
{{ $otherLyrics := where $publishedLyrics "Permalink" "ne" .Permalink }}

{{ $withDate := where $otherLyrics "Date" "!=" nil }}
{{ $withoutDate := where $otherLyrics "Date" "==" nil }}

{{ $sortedWithDate := sort $withDate ".Date" "desc" }}
{{ $sortedWithoutDate := sort $withoutDate ".Lastmod" "desc" }}

{{ $pastLyrics := $sortedWithDate | append $sortedWithoutDate }}

<ul class="widget-list">
  {{ range $pastLyrics }}
    <li>
      <a href="{{ .RelPermalink }}">{{ .Title }}</a>
      {{ if .Date }}
        <span class="post-date">{{ .Date.Format "2006-01-02" }}</span>
      {{ else if .Lastmod }}
        <span class="post-date">{{ .Lastmod.Format "2006-01-02" }}</span>
      {{ end }}
    </li>
  {{ else }}
    <li>暂无过往的每周一曲</li>
  {{ end }}
</ul>
